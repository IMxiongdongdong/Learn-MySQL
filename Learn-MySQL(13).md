# 第十三天

## 1. 索引

### 1. 索引的含义

索引是对数据库表中一列或多列的值进行排序的一种结构，使用索引可提高数据库中特定数据的查询速度。索引的优点主要有：

* 通过创建唯一索引，可以保证数据库表中每一行数据的唯一性。

* 可以大大加快数据的查询速度。

* 在实现数据的参考完整性方面，可以加速表和表之间的连接。

* 在使用分组和排序子句进行数据查询时，可以显著减少查询中分组和排序的时间。

增加索引也有许多不利的方面，主要表现在如下几个方面：

* 创建索引和维护索引要耗费时间，并且随着数据量的增加所耗费的时间也会增加。

* 索引需要占磁盘空间，除了数据表占数据空间之外，每一个索引还要占一定的物理空间，如果有大量的索引，索引文件可能比数据文件更快达到最大文件尺寸。

* 当对表中的数据进行增加、删除和修改的时候，索引也要动态的维护，这样就降低了数据的维护速度。

### 2. 索引的分类

#### 2.1 普通索引和唯一索引

普通索引时`MySQL`中的基本索引类型，允许在定义索引的列中插入重复值和空值。

唯一索引，索引列的值必须唯一，但允许有空值。如果是组合索引，则列值的组合必须唯一。主键索引是一种特殊的唯一索引，不允许有空值。

#### 2.2 单列索引和组合索引

单列索引即一个索引只包含单个列，一个表可以有多个单列索引。

组合索引指在表的多个字段组合上创建的索引，只有在查询条件中使用了这些字段的左边字段是，索引才会被使用。使用组合索引时遵循最左前缀集合。

#### 2.3 全文索引

全文索引类型为`FULLTEXT`，在定义索引的列上支持值的全文查找，允许在这些索引列中插入重复值和空值。全文索引可以在`CHAR`，`VARCHAR`或者`TEXT`类型的列上创建。`MySQL`中只有`MyISAM`存储引擎支持全文索引。

#### 2.4 空间索引

空间索引是对空间数据类型的字段建立的索引，`MySQL`中的空间数据类型有4种，分别是：`GEOMETRY`，`POINT`，`LINESTRING`和`POLYGON`。`MySQL`使用`SPATIAL`关键字进行扩展，使得能够用于创建正规索引类似的语法创建空间索引。创建空间索引的列，必须将其声明为`NOT NULL`，空间索引只能在存储引擎为`MyISAM`的表中创建。

### 3. 索引的设计原则

索引的设计不合理或者缺少索引都会对数据库和应用程序的性能造成障碍，设计索引时，应该考虑以下：

* 索引并非越多越好，一个表中如果有大量的索引，不仅占用磁盘空间，而且也会影响`INSERT`，`DELETE`，`UPDATE`等语句的性能，因为当表中的数据更改的同时，索引也会进行调整和更新。
* 避免对经常更新的表进行过多的索引，并且索引种的列尽可能少。而对经常用于查询的字段应该创建索引，但要避免添加不必要的字段。
* 数据量小的表最好不要使用索引，由于数据较少，查询花费的时间可能比便利索引的时间还要短，索引可能不会产生优化效果。
* 在条件表达式中经常用到的不同值较多的列上建立索引，在不同值较少的列上不要建立索引。
* 当唯一性是某种数据本身的额特征时，指定唯一索引。
* 在频繁进行排序或分组的列上建立索引，如果待排序的列有多个，可以在这些列上建立组合索引。

## 2. 创建索引

#### 2.1 创建表的时候创建索引

使用`CREATE TABLE`创建表时，除了可以定义列的数据类型，还可以定义主键约束、外键约束或者唯一性约束，而不论创建哪种约束，在定义约束的同时相当于在指定列上创建了一个索引。创建表时创建索引的基本语法格式如下：

~~~mysql
CRETAE TABLE table_name[col_name data_type]
[UNIQUE|FULLTEXT|SPATIAL][INDEX|KEY][index_name](col_name[length])[ASC|DESC]
~~~

`UNIQUE`，`FULLTEXT`和`SPATIAL`为可选参数，分别表示唯一索引、全文索引和空间索引。`INDEX`与`KEY`为同义词，两者作用相同，用来指定创建索引；`col_name`为需要创建索引的字段列，该列必须从数据表中该定义的多个列中选择；`index_name`指定索引的名称，为可选参数，如果不指定，`MySQL`默认`col_name`为索引值；`length`为可选参数，表示索引的长度，只有字符串类型的字段才能指定索引长度；`ASC`或`DESC`指定升序或者降序的索引值存储。

* 创建普通索引

  最基本的索引类型，没有唯一性值类的限制，其作用只是加快对数据的访问速度。

* 创建唯一索引

  创建索引的主要原因是减少查询索引列操作的执行时间，尤其是对比较庞大的数据表，它与普通索引类似，不同就是索引列的值必须唯一，但允许有空值。如果是组合索引，则列值的组合必须唯一。
  
* 创建单列索引

  单列索引是在数据表中的某一个字段上创建的索引，一个表中可以创建多个单列索引。

* 创建组合索引

  组合索引是在多个字段上创建一个索引。

* 创建全文索引

  `FULLTEXT`全文索引可以用于全文搜索，只有`MyISAM`存储引擎支持`FULLTEXT`索引，并且只为`CHAR`、`VARCHAR`和`TEXT`列。索引总是对整个列进行，不支持局部（前缀）索引。

* 创建空间索引

  空间索引必须在`MyIASM`类型的表中创建，且空间类型的字段必须为非空。

#### 2.2 在已经存在的表上创建索引

在已经存在的表中创建索引，可以使用`ALTER TABLE`语句或者`CREATE INDEX`语句。

* 使用`ALTER TABLE`语句创建索引

  ~~~mysql
  ALTER TABLE table_name ADD [UNIQUE|FULLTEXT|SPATIAL] [INDEX|KEY]
  [index_name](col_name[length],...)[ASC|DESC]
  ~~~

* 使用`CREATE INDEX`创建索引

  `CREATE INDEX`语句可以在已经存在的表上添加索引，`MySQL`中`CREATE INDEX`被映射到一个`ALTER TABLE`语句上，语法格式为：

  ~~~mysql
  CREATE [UNIQUE|FULLTEXT|SPATIAL]INDEX index_name
  ON table_name(col_name[legth],...)[ASC|DESC]
  ~~~

### 3. 删除索引

#### 3.1 使用`ALTER TABLE`删除索引

语法格式如下：

~~~mysql
ALTER TABLE table_name DROP INDEX index_name;
~~~

#### 3.2 使用`DROP INDEX`语句删除索引

语法格式如下：

~~~mysql
DROP INDEX index_name ON table_name;
~~~